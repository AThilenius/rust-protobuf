# Changelog

## [Unreleased]

### Backward compatibility

Version 3.0 is backward incompatible with 2.0 version. Changes are listed here:

- All fields are public now except optional or repeated fields when `syntax = "proto2"`,
  but message fields are public even when `syntax = "proto2"`
- Field accessors (getters and setters) are not generated by default for public fields
- [`Default` is implemented for enums even in proto2](
  https://github.com/stepancheg/rust-protobuf/commit/166966627ebc1e5ce650acd1593489e52757178e)
- [Remove global `parse_length_delimited*`
  functions](https://github.com/stepancheg/rust-protobuf/commit/91c0875e909cdc0648256f0c45cd4a9ade1e4fa0)
- `PartialEq` with large number of fields
  [now panics](https://github.com/stepancheg/rust-protobuf/commit/4f1ca564a00e85b6e3821e91aace71ccb6592bf5).
  Previosly it could cause stack overflow in the Rust compiler.
  
### New features

- [Option to store repeated message fields in `Vec` instead of `RepeatedField`](
  https://github.com/stepancheg/rust-protobuf/issues/280). This option may be turned on by default later.
- Similarly, [option to store singular field on `Option` instead of `SingularPtrField`](
  https://github.com/stepancheg/rust-protobuf/issues/300), which also may be turned on by default later.
- `generate_accessors` and `generate_getter` options to disable generation of accessor functions.
- [Flush `CodedOutputStream` on `drop`](https://github.com/stepancheg/rust-protobuf/commit/0e9cc5964c2731a771725bcf70125d3eb1c273b3)
- [Implement `Hash` for
  `UnknownFields`](https://github.com/stepancheg/rust-protobuf/commit/113babc8c56deb7e2453f0d11c2bfc21134d540f)

### Improvements

- [JSON printing/parsing](https://github.com/stepancheg/rust-protobuf/issues/142) implemented
- Text format parsing is implemented (previously it was only possible to print to text format)
- Reflection can now mutate data (previously reflection could only read data)
- Fix OOM on malformed input
- [`unknown_fields` field is public now](https://github.com/stepancheg/rust-protobuf/commit/24e6479e869d61455bfcf50dde102e6278648516)
- [Unsafe code is not used in generated code](https://github.com/stepancheg/rust-protobuf/issues/340)
  (although protobuf implementation does a couple of unsafe calls).

## [2.1 Unreleased]

## [2.1.3] - 2018-10-31

- [Replace old clippy annotations with recommended new
  annotations)[https://github.com/stepancheg/rust-protobuf/pull/332]

## [2.1.2] - 2018-10-28

- [`cached_size` field is public now](https://github.com/stepancheg/rust-protobuf/issues/348)

## [2.1.1] - 2018-10-09

- [Make `Customize::_future_options` public](https://github.com/stepancheg/rust-protobuf/pull/346)

## [2.1.0] - 2018-10-06

- Support of `protoc` command from Google protobuf before 3.0 is dropped
  (it might work, but not tested by CI); this does not affect `syntax = "proto2"` which is supported
- [When using `protoc` codegen options can now be passed with `--rust_opt`
  flag](https://github.com/stepancheg/rust-protobuf/commit/7ebf32b47cb18160752a943dccb9d0d7ecdf91ed)
- [Serde is now supported](https://github.com/stepancheg/rust-protobuf/issues/266)

## [2.0.5] - 2018-09-21

- [Global `parse_length_delimited*` functions are
  deprecated](https://github.com/stepancheg/rust-protobuf/commit/efdfd5cacfa4f87b2a6e3ffc124d77692db142d9)
- [Fixed a bug with quotes in string literal parsing in pure
  codegen](https://github.com/stepancheg/rust-protobuf/issues/337)

## [2.0.4] - 2018-07-19

- Minimum bytes version is 0.4 now (since protobuf doesn't work with 0.3 anyway)

## [2.0.3] - 2018-07-11

- [Fix panic on singular string field appeared more than
  once](https://github.com/stepancheg/rust-protobuf/commit/28adf07a0b0027ddc8ff57f04ffeb69f35f65620)
- [Properly handle map fields with key or value skipped in binary proto](
  https://github.com/stepancheg/rust-protobuf/issues/318)

## [2.0.2] - 2018-05-29

- Make rust-protobuf compatible with rust 1.23.0

## [2.0.1] - 2018-05-27

- Fix codegen with enum with
  [default value a reserved rust keyword](https://github.com/stepancheg/rust-protobuf/issues/295)

## [2.0.0] - 2018-05-17

- Rebublished branch 1.6 because of
  [backward compatibility issues in 1.6 branch](https://github.com/stepancheg/rust-protobuf/issues/289)

## [1.7.4] - 2018-07-11

- [Fix panic on singular string field appeared more than
  once](https://github.com/stepancheg/rust-protobuf/commit/28adf07a0b0027ddc8ff57f04ffeb69f35f65620)
- [Properly handle map fields with key or value skipped in binary proto](
  https://github.com/stepancheg/rust-protobuf/issues/318)

## [1.7.3] - 2018-05-29

- Make rust-protobuf compatible with rust 1.23.0

## [1.7.2] - 2018-05-27

- Fix codegen with enum with
  [default value a reserved rust keyword](https://github.com/stepancheg/rust-protobuf/issues/295)

## [1.7.1] - 2018-05-17

- Rebublished branch 1.5 because of
  [backward compatibility issues in 1.6 branch](https://github.com/stepancheg/rust-protobuf/issues/289)

## [1.6.0] - 2018-05-11

Republished as 2.0.0

### New features

- [Pure rust codegen](https://github.com/stepancheg/rust-protobuf/tree/master/protobuf-codegen-pure)
- Generated code can now be customized not only with `rustproto.proto`
  but also when invoked programmatically with
  [`protoc-rust`](https://github.com/stepancheg/rust-protobuf/blob/b8573bd53cf5a9611598abbf02b71c49e59a8891/protobuf-codegen/src/customize.rs#L9)
- [Oneof are now public by
  default](https://github.com/stepancheg/rust-protobuf/commit/8bd911e2ea0d4461580105209ae11d9d3ec21fd0)
- [Option to specify recursion limit](https://github.com/stepancheg/rust-protobuf/pull/248)
- [Implement conversions for `Repeated*`](https://github.com/stepancheg/rust-protobuf/pull/236)
- [Proto files with suffixes others than `.proto`
  are now supported](https://github.com/stepancheg/rust-protobuf/pull/265)
- [Generated code now uses closures instead of private functions
  for reflection](https://github.com/stepancheg/rust-protobuf/pull/267)

### Backward compatibility issues

- [Drop `MessageStatic` trait](https://github.com/stepancheg/rust-protobuf/issues/214)
- [Protobuf no longer exposes internal `hex`
  module](https://github.com/stepancheg/rust-protobuf/commit/8ad9687529a565c5ef2db93732cc20c8d8d22f00)
- [`protobuf-codegen` is a separate crate](https://github.com/stepancheg/rust-protobuf/pull/261)
- [Drop old reflection
  accessors](https://github.com/stepancheg/rust-protobuf/commit/7a03aee4e67bdd25ae6c403f37386707a0ab5eb9).
  Now code may need to be regenerated when protobuf version changed.
- [Implement `std::io` traits by `CodedInputStream` and
  `CodedOutputStream`](https://github.com/stepancheg/rust-protobuf/pull/232)
- `*descriptor_static()` function signatures no longer include `Option` param
  ([1](https://github.com/stepancheg/rust-protobuf/commit/8723fca5fb29e279b3ab7d2a28c8fab79189c9c2),
  [2](https://github.com/stepancheg/rust-protobuf/commit/c5446983be3b9d8d49ee39b443ed4fabd8f35440))

## [1.5.1] - 2018-04-02
- [Fix serialization or large repeated packed fields](https://github.com/stepancheg/rust-protobuf/issues/281)

## [1.5.0] - 2018-03-25
- [Unknown enum values are now stored in unknown fields](https://github.com/stepancheg/rust-protobuf/pull/276)

## [1.4.5] - 2018-04-02
- [Fix serialization or large repeated packed fields](https://github.com/stepancheg/rust-protobuf/issues/281)

## [1.4.4] - 2018-03-05
- [Escape macro keyword](https://github.com/stepancheg/rust-protobuf/pull/269)

## [1.4.3] - 2017-12-03
- [Allow enum variants to be named `Self`](https://github.com/stepancheg/rust-protobuf/pull/259)

## [1.4.2] - 2017-10-14
- [Properly read messages from blocking streams](https://github.com/stepancheg/rust-protobuf/issues/157)

## [1.4.1] - 2017-06-24
- [Convert `String` to `Chars`](https://github.com/stepancheg/rust-protobuf/pull/225)

## [1.4] - 2017-06-24
- Start of changelog
