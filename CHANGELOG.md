# Changelog

## [Unreleased]

### Backward compatibility

Version 3.0 is backward incompatible with 2.0 version. Changes are listed here:

- Enum fields are now
  [generated as `ProtobufEnumOrUnknown<E>`](https://github.com/stepancheg/rust-protobuf/issues/233)
- Nested messages are now
  [generated in nested mods](https://github.com/stepancheg/rust-protobuf/commit/da2e25dc6c20efcea3893c78e587b43b89da9528)
- All fields are public now except optional or repeated fields when `syntax = "proto2"`,
  but message fields are public even when `syntax = "proto2"`
- Field accessors (getters and setters) are not generated by default for public fields
- [Remove global `parse_length_delimited*`
  functions](https://github.com/stepancheg/rust-protobuf/commit/91c0875e909cdc0648256f0c45cd4a9ade1e4fa0)
- `PartialEq` with large number of fields
  [now panics](https://github.com/stepancheg/rust-protobuf/commit/4f1ca564a00e85b6e3821e91aace71ccb6592bf5).
  Previosly it could cause stack overflow in the Rust compiler.
- [Change `message_down_cast*` functions
  signatures](https://github.com/stepancheg/rust-protobuf/commit/a05a4216fc3305c67b7a2d19011be3bd503d5166)
- [Remove `descriptorx` from `protobuf`
  crate](https://github.com/stepancheg/rust-protobuf/commit/4e8896645c3e017ac91f529cb69ce76b002f6fc1)
  
### New features

- [Option to store repeated message fields in `Vec` instead of `RepeatedField`](
  https://github.com/stepancheg/rust-protobuf/issues/280). This option may be turned on by default later.
- Similarly, [option to store singular field on `Option` instead of `SingularPtrField`](
  https://github.com/stepancheg/rust-protobuf/issues/300), which also may be turned on by default later.
- `generate_getter` option to disable generation of getters functions.
- [Flush `CodedOutputStream` on `drop`](https://github.com/stepancheg/rust-protobuf/commit/0e9cc5964c2731a771725bcf70125d3eb1c273b3)

### Improvements

- [JSON printing/parsing](https://github.com/stepancheg/rust-protobuf/issues/142) implemented
- Text format parsing is implemented (previously it was only possible to print to text format)
- Reflection can now mutate data (previously reflection could only read data)
- [Unsafe code is not used in generated code](https://github.com/stepancheg/rust-protobuf/issues/340)
  (although protobuf implementation does a couple of unsafe calls).

## [2.7] - Unreleased
- Minimum supported Rust version
  [is 1.27](https://github.com/stepancheg/rust-protobuf/commit/f51811e8376f7c46b433479903a1bd8670246aa0).
  This version stabilizes `dyn Trait` syntax.
- `inside_protobuf` option is added which slightly modifies generated code inside protobuf.
  Should not affect users.
- [Generated files are now compatible only with the same version of
  runtime](https://github.com/stepancheg/rust-protobuf/commit/2ab4d50c27c4dd7803b64ce1a43e2c134532c7a6)

## [2.6.2] - 2019-06-03
- Fix [OOM on malformed input for fields of type
  `bytes::Bytes`](https://github.com/stepancheg/rust-protobuf/issues/411)

## [2.6.1] - 2019-05-27

- [Fix `Hash` of
  `UnknownFields`](https://github.com/stepancheg/rust-protobuf/commit/7f285cc42990e34bd8a489519aaae216a93584cf)
- Improve rustdoc a little

## [2.6.0] - 2019-05-19

- [lite_runtime rust-protobuf option](https://github.com/stepancheg/rust-protobuf/pull/399)
- Fix [OOM on malformed input](https://github.com/stepancheg/rust-protobuf/issues/411)
- Minimum supported Rust version is [1.26](https://github.com/stepancheg/rust-protobuf/commit/71f09ae92e86be2ce439e71452c3ca1749a4bda7)
- [Implement `Hash` for
  `UnknownFields`](https://github.com/stepancheg/rust-protobuf/commit/113babc8c56deb7e2453f0d11c2bfc21134d540f)

## [2.5.0] - 2019-04-15

- `generate_accessors` options to disable generation of accessor functions (except getters).
- [`Default` is now implented for all `&MyMessage`
  types](https://github.com/stepancheg/rust-protobuf/commit/c026777976c895898fb50bc7c52802967bd33af5#diff-405e0ba76bb0afaaa4e11e89bc4bb943R4)
- [`Debug` is now implemented for oneof enums](https://github.com/stepancheg/rust-protobuf/issues/397)
  
## [2.4.2] - 2019-03-29

- [Fix well-known types codegen](https://github.com/stepancheg/grpc-rust/issues/129)
- [More extension types are supported now](https://github.com/stepancheg/rust-protobuf/issues/392)

## [2.3.1] - 2019-03-05

- [Fix codegen when `syntax = "proto2"` and `with-bytes` option and string field with default
  value](https://github.com/stepancheg/rust-protobuf/issues/395)

## [2.3.0] - 2019-01-30

- [`Default` is implemented for enums even in proto2](
  https://github.com/stepancheg/rust-protobuf/commit/166966627ebc1e5ce650acd1593489e52757178e)
- [Fix codegen where map value is an enum](https://github.com/stepancheg/rust-protobuf/issues/376)

## [2.2.5] - 2019-01-20

- [Escape extension field names](https://github.com/stepancheg/rust-protobuf/issues/371)

## [2.2.4] - 2019-01-13

- [Replace tempdir dependency with tempfile](https://github.com/stepancheg/rust-protobuf/pull/374)
- [Fix serialization of signed int map keys or values](https://github.com/stepancheg/rust-protobuf/pull/372)

## [2.2.2] - 2018-12-29

- [Fix codegen on Windows](https://github.com/stepancheg/rust-protobuf/issues/356)

## [2.2.1] - 2018-12-25

- [Fix panic with oneof and bytes codegen](https://github.com/stepancheg/rust-protobuf/issues/362)

## [2.2.0] - 2018-11-17

- [Implement](https://github.com/stepancheg/rust-protobuf/commit/c0856a0b7b9a74224d535ecb691c46669c86a878)
  `From<Option<T>> for SingularPtrField<T>`
  
## [2.1.5] - 2019-01-13

- [Fix serialization of signed int map keys or values](https://github.com/stepancheg/rust-protobuf/pull/372)

## [2.1.4] - 2018-11-01

- Revert clippy annotations

## [2.1.3] - 2018-10-31

- [Replace old clippy annotations with recommended new
  annotations](https://github.com/stepancheg/rust-protobuf/pull/332)

## [2.1.2] - 2018-10-28

- [`cached_size` field is public now](https://github.com/stepancheg/rust-protobuf/issues/348)

## [2.1.1] - 2018-10-09

- [Make `Customize::_future_options` public](https://github.com/stepancheg/rust-protobuf/pull/346)

## [2.1.0] - 2018-10-06

- Support of `protoc` command from Google protobuf before 3.0 is dropped
  (it might work, but not tested by CI); this does not affect `syntax = "proto2"` which is supported
- [When using `protoc` codegen options can now be passed with `--rust_opt`
  flag](https://github.com/stepancheg/rust-protobuf/commit/7ebf32b47cb18160752a943dccb9d0d7ecdf91ed)
- [Serde is now supported](https://github.com/stepancheg/rust-protobuf/issues/266)
- [`unknown_fields` field is public now](https://github.com/stepancheg/rust-protobuf/commit/24e6479e869d61455bfcf50dde102e6278648516)

## [2.0.6] - 2019-01-13

- [Fix serialization of signed int map keys or values](https://github.com/stepancheg/rust-protobuf/pull/372)

## [2.0.5] - 2018-09-21

- [Global `parse_length_delimited*` functions are
  deprecated](https://github.com/stepancheg/rust-protobuf/commit/efdfd5cacfa4f87b2a6e3ffc124d77692db142d9)
- [Fixed a bug with quotes in string literal parsing in pure
  codegen](https://github.com/stepancheg/rust-protobuf/issues/337)

## [2.0.4] - 2018-07-19

- Minimum bytes version is 0.4 now (since protobuf doesn't work with 0.3 anyway)

## [2.0.3] - 2018-07-11

- [Fix panic on singular string field appeared more than
  once](https://github.com/stepancheg/rust-protobuf/commit/28adf07a0b0027ddc8ff57f04ffeb69f35f65620)
- [Properly handle map fields with key or value skipped in binary proto](
  https://github.com/stepancheg/rust-protobuf/issues/318)

## [2.0.2] - 2018-05-29

- Make rust-protobuf compatible with rust 1.23.0

## [2.0.1] - 2018-05-27

- Fix codegen with enum with
  [default value a reserved rust keyword](https://github.com/stepancheg/rust-protobuf/issues/295)

## [2.0.0] - 2018-05-17

- Rebublished branch 1.6 because of
  [backward compatibility issues in 1.6 branch](https://github.com/stepancheg/rust-protobuf/issues/289)

## [1.7.5] - 2018-05-20
- Fix [OOM on malformed input](https://github.com/stepancheg/rust-protobuf/issues/411)

## [1.7.4] - 2018-07-11

- [Fix panic on singular string field appeared more than
  once](https://github.com/stepancheg/rust-protobuf/commit/28adf07a0b0027ddc8ff57f04ffeb69f35f65620)
- [Properly handle map fields with key or value skipped in binary proto](
  https://github.com/stepancheg/rust-protobuf/issues/318)

## [1.7.3] - 2018-05-29

- Make rust-protobuf compatible with rust 1.23.0

## [1.7.2] - 2018-05-27

- Fix codegen with enum with
  [default value a reserved rust keyword](https://github.com/stepancheg/rust-protobuf/issues/295)

## [1.7.1] - 2018-05-17

- Rebublished branch 1.5 because of
  [backward compatibility issues in 1.6 branch](https://github.com/stepancheg/rust-protobuf/issues/289)

## [1.6.0] - 2018-05-11

Republished as 2.0.0

### New features

- [Pure rust codegen](https://github.com/stepancheg/rust-protobuf/tree/master/protobuf-codegen-pure)
- Generated code can now be customized not only with `rustproto.proto`
  but also when invoked programmatically with
  [`protoc-rust`](https://github.com/stepancheg/rust-protobuf/blob/b8573bd53cf5a9611598abbf02b71c49e59a8891/protobuf-codegen/src/customize.rs#L9)
- [Oneof are now public by
  default](https://github.com/stepancheg/rust-protobuf/commit/8bd911e2ea0d4461580105209ae11d9d3ec21fd0)
- [Option to specify recursion limit](https://github.com/stepancheg/rust-protobuf/pull/248)
- [Implement conversions for `Repeated*`](https://github.com/stepancheg/rust-protobuf/pull/236)
- [Proto files with suffixes others than `.proto`
  are now supported](https://github.com/stepancheg/rust-protobuf/pull/265)
- [Generated code now uses closures instead of private functions
  for reflection](https://github.com/stepancheg/rust-protobuf/pull/267)

### Backward compatibility issues

- [Drop `MessageStatic` trait](https://github.com/stepancheg/rust-protobuf/issues/214)
- [Protobuf no longer exposes internal `hex`
  module](https://github.com/stepancheg/rust-protobuf/commit/8ad9687529a565c5ef2db93732cc20c8d8d22f00)
- [`protobuf-codegen` is a separate crate](https://github.com/stepancheg/rust-protobuf/pull/261)
- [Drop old reflection
  accessors](https://github.com/stepancheg/rust-protobuf/commit/7a03aee4e67bdd25ae6c403f37386707a0ab5eb9).
  Now code may need to be regenerated when protobuf version changed.
- [Implement `std::io` traits by `CodedInputStream` and
  `CodedOutputStream`](https://github.com/stepancheg/rust-protobuf/pull/232)
- `*descriptor_static()` function signatures no longer include `Option` param
  ([1](https://github.com/stepancheg/rust-protobuf/commit/8723fca5fb29e279b3ab7d2a28c8fab79189c9c2),
  [2](https://github.com/stepancheg/rust-protobuf/commit/c5446983be3b9d8d49ee39b443ed4fabd8f35440))

## [1.5.1] - 2018-04-02
- [Fix serialization or large repeated packed fields](https://github.com/stepancheg/rust-protobuf/issues/281)

## [1.5.0] - 2018-03-25
- [Unknown enum values are now stored in unknown fields](https://github.com/stepancheg/rust-protobuf/pull/276)

## [1.4.5] - 2018-04-02
- [Fix serialization or large repeated packed fields](https://github.com/stepancheg/rust-protobuf/issues/281)

## [1.4.4] - 2018-03-05
- [Escape macro keyword](https://github.com/stepancheg/rust-protobuf/pull/269)

## [1.4.3] - 2017-12-03
- [Allow enum variants to be named `Self`](https://github.com/stepancheg/rust-protobuf/pull/259)

## [1.4.2] - 2017-10-14
- [Properly read messages from blocking streams](https://github.com/stepancheg/rust-protobuf/issues/157)

## [1.4.1] - 2017-06-24
- [Convert `String` to `Chars`](https://github.com/stepancheg/rust-protobuf/pull/225)

## [1.4] - 2017-06-24
- Start of changelog
